/**
 * The Scene Object
 *
 * @namespace GIScene
 * @class Scene
 * @constructor
 * @extends THREE.EventDispatcher
 * @param {String} containerDivId The id of an HTMLDivElement which will be used as container for the webgl canvas.
 * @param {Object} [config] Allowed
 * values for config are:
 *
 * 	cameratype:	'perspective'|'ortho'
 *  near: {Number}
 *  far:  {Numver}
 *  fov:  {Number}
 * 
 *  width:	{Integer}
 *  height: {Integer}
 * 
 *  animate:{Boolean}
 *  
 *  center: 				{THREE.Vector3}
 *  positionFromCenter: 	{THREE.Vector3}
 *  projection: 			{String}
 *  units:					{String}
 *  offset:					{GIScene.Coordinate3}
 *  skyColor:				{THREE.Color}
 *  fog:					{THREE.Fog}
 */

GIScene.Scene = function(containerDivId, config) {

	/**
	 * The default config which is used when no config object is provided.
	 *
	 * @private
	 * @property defaults
	 * @type Object
	 **/
	var defaults = {

		//canvas options
		width : null,
		height : null,

		//render options
		animate : true, 
		fog : null,

		//scene options
		center : new THREE.Vector3(0, 0, 0),
		projection : 'EPSG:32616', //not yet used UTM16N???-->EPSG:32616
		units : 'm', //not yet used
		offset : new GIScene.Coordinate3(0,0,0), 
		//new THREE.Vector3(0,0,0), //new THREE.Vector3(269500, 550, -1641500), //not yet used offset is used to keep coordinates short.
		skyColor : new THREE.Color().setStyle('lightskyblue').getHex(),

		//camera options
		cameratype : 'perspective',
		near : 0.1,
		far : 1000,
		fov : 45, //for perspective camera only
		positionFromCenter : new THREE.Vector3(0, 0, 10)

	};

	/**
	 * The config which is used to initialize the Scene. Merged from defaults and passed config Object.
	 *
	 * @property config
	 * @type Object
	 */
	this.config = GIScene.Utils.mergeObjects(defaults, config || {});


	//make this class an EventDispatcher
	//THREE.EventDispatcher.call( this );

	//canvas properties
	this.containerDiv = document.getElementById(containerDivId);
	this.canvas = null;
	//get size from config else from containerDiv-CSS Style else use default 500x500 px
	var width = null;
	width = (this.config.width) ? this.config.width :  this.containerDiv.clientWidth ;
	
	var height = null;
	height = (this.config.height) ?  this.config.height : (this.containerDiv.clientHeight > 0) ?  this.containerDiv.clientHeight :  500;

	//render properties
	var animationFrameId;

	//scene properties
	/**
	 * The scenegraph root node. Add {THREE.Object3D}-objects to this node. See THREE.js docs for further information
	 * @property root
	 * @type {THREE.Scene}
	 */
	this.root = null;
	/**
	 * The active camera. {THREE.CombinedCamera} can be switched from perspective to orthographic and vice versa
	 * @property camera
	 * @type {THREE.CombinedCamera}
	 */
	this.camera = null;
	//Camera gets a target object later in initScene()
	
	//THREE.Scene and THREE.Orthocamera to render Sprites in screen coordinate space
	this.spriteRoot = null;
	this.spriteCamera = null;
	
	this.lights = [];
	this.renderer = null;
	this.effectComposer = null;
	this.fog = null;
	this.layers = [];
	//Layers should add {THREE.Scene} objects to this.root
	this.center = new THREE.Vector3(0, 0, 0);

	//controls
	this.controls = [];

	//clock to be independent of framerates
	this.clock = new THREE.Clock();
	this.delta = null; //global, automatically updated in startAnimation() every frame

	this.init = function() {

		//initCanvas
		this.initCanvas();

		//initScene
		this.initScene();

		//animate: start renderLoop or render once
		(this.config.animate) ? this.startAnimation() : this.renderer.render(this.root, this.camera);

	};

	this.initCanvas = function() {
		//create canvas in div use div use size from config else from div element else
		this.canvas = document.createElement('canvas');
		this.canvas.className = "giscene_canvas";
		//remove line height from canvas containterDiv to fit the canvas exactly to its wrapper div
		this.containerDiv.style.lineHeight = 0;
		
		
		
		// this.canvas.style.width  = "100%";//width + "px";//
		// this.canvas.style.height = "100%";//height + "px";//
		this.containerDiv.appendChild(this.canvas);
		// this.containerDiv.style.width  = width + "px";
		// this.containerDiv.style.height = height + "px";
	};

	this.initScene = function(config) {
		//create THREE.Scene
		this.root = new THREE.Scene();
		this.root.name = 'root';
		
		//optionally add fog
		if(this.config.fog){this.root.fog = this.fog = this.config.fog.clone();}
		
		//initCamera
		//this.camera = (this.config.cameratype == 'ortho') ? new THREE.OrthographicCamera(width / -2, width / 2, height / 2, height / -2, this.config.near, this.config.far) : new THREE.PerspectiveCamera(this.config.fov, width / height, this.config.near, this.config.far);
		this.camera = new THREE.CombinedCamera(width, height, this.config.fov, this.config.near, this.config.far, this.config.near, this.config.far );
		this.camera.name = 'THREE.CombinedCamera';
		this.camera.target = new THREE.Object3D();
		this.camera.target.name = "Camera target";
		this.camera.add(this.camera.target);
		if(this.config.cameratype == 'ortho'){this.camera.toOrthographic();}

		/**
		 * Fires whenever camera position changes
		 *
		 * @event cameraChange
		 */
		var oldCamPos = new THREE.Vector3(0, 0, 0);
		var oldCamRot = new THREE.Vector3(0, 0, 0);
		var cameraHasChanged = function() {
			if (!oldCamPos.equals(this.camera.position) || !oldCamRot.equals(this.camera.rotation)) {
				
				this.dispatchEvent({type : 'cameraChange'});
				oldCamPos = this.camera.position.clone();
				oldCamRot = this.camera.rotation.clone();
			};
			
		}.bind(this);
		this.addEventListener('afterRender', cameraHasChanged);
		//this.addEventListener('beforeRender', cameraHasChanged);
		
		//init sprite scene and camera
		this.spriteRoot = new THREE.Scene();
		// this.spriteCamera = new THREE.OrthographicCamera(0,width,0,height,-100,100 ); //l,r,t,b,near,far
		var width1_2 = width/2;
		var heigh1_2 = height/2;
		this.spriteCamera = new THREE.OrthographicCamera(-width1_2,width1_2,heigh1_2,-heigh1_2,-100,100 ); //l,r,t,b,near,far
		// this.spriteRoot.add(this.spriteCamera);
		// this.camera.add(this.spriteCamera);
		
		//initLights
		this.directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);//new THREE.DirectionalLight(0xffffff, 0.5);
		this.directionalLight.name = "THREE.DirectionalLight";
		//color, intensity //position will be set by Control.CameraLight
		this.ambientLight = new THREE.AmbientLight(0x808080); //80^=0.5   cc ^= 0.8   new THREE.AmbientLight(0xffffff);
		this.ambientLight.name = "THREE.AmbientLight";

		//experimental spot light
		this.headLight = new THREE.SpotLight(0xffffff,0.3,0,Math.PI/2,20);
		this.camera.add(this.headLight);
		this.headLight.target.position.setZ(-1000);
		this.camera.target.add(this.headLight.target);

		//initRenderer
		this.renderer = new THREE.WebGLRenderer({
			antialias : true,
			precision : "highp",
			canvas : this.canvas,
			devicePixelRatio: 1, //when browser is in zoom mode this ratio is changed and renderer.setSize uses it 
		});
		
		this.renderer.setSize(width, height);
		this.renderer.setClearColor(this.config.skyColor);
		this.renderer.autoClear = false;
		
		// init effectComposer
		this.effectComposer = new THREE.EffectComposer(this.renderer);
		this.effectComposer.setSize(width, height);
		
		// add objects to the scene
		this.root.add(this.camera);
		this.root.add(this.ambientLight);
		this.root.add(this.directionalLight);

		//setCenter
		// this.camera.position.add(this.config.positionFromCenter);
		// this.camera.target.position.setZ(-this.config.positionFromCenter.length());
		this.setCenter(this.config.center, this.config.positionFromCenter,0);
		
		//add Logo
		var gisceneLogoTexture = new THREE.Texture(null);
		var gisceneLogoImage = new Image();
		gisceneLogoImage.onload = function(e) {
			gisceneLogoTexture.image = gisceneLogoImage;
			gisceneLogoTexture.needsUpdate = true;
		};
		// dataURL from poweredbygiscenegiscience.png
		// gisceneLogoImage.src = "data:image/png;base64,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";	
		// dataURL from poweredbygiscenegiscience2.png
		//gisceneLogoImage.src = "data:image/png;base64,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";
		// dataURL from poweredbygiscenegiscience3.png
		gisceneLogoImage.src = " data:image/png;base64,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";
		var gisceneLogoMaterial = new THREE.SpriteMaterial({ map : gisceneLogoTexture, opacity:1  });
		var gisceneLogo = new THREE.Sprite(gisceneLogoMaterial);
		gisceneLogo.scale.set( 158, 20, 1 );
		gisceneLogo.position.set((this.canvas.width/2)-79,(-this.canvas.height/2)+10,0);
		this.spriteRoot.add(gisceneLogo);
		//will be called in this.onResize
		this.logoOnResize = function() {
			gisceneLogo.position.set((this.canvas.width/2)-79,(-this.canvas.height/2)+10,0);
		}.bind(this);
		

	};

	/**
	 * Start animation frame and render loop
	 *
	 * @method startAnimation
	 */
	this.startAnimation = function() {
		animationFrameId = requestAnimationFrame(this.startAnimation.bind(this));
		
		this.delta = this.clock.getDelta();
		
		TWEEN.update();
		
		this.renderer.clear(true,true,true); //color, depth, stencil; autoclear is false to render sprites on top of scene
		/**
		 * beforeRender Event will be executed directly before the render call in the render loop
		 * @event beforeRender
		 */
		this.dispatchEvent({
			type : 'beforeRender'
		});
		/**
		 * beforeRender2 Event will be executed directly before the render call in the render loop
		 * @event beforeRender
		 */
		this.dispatchEvent({
			type : 'beforeRender2'
		});
		
		//mcaTWEEN.update();	
		
		if(this.effectComposer.passes.length>0){
			this.effectComposer.render();
		}else{
			this.renderer.render(this.root, this.camera);
		}
		
		this.renderer.clear(false,true,false); //render sprites always on top, therefore clear depth buffer
		this.renderer.render(this.spriteRoot, this.spriteCamera);
		
		this.dispatchEvent({
			type : 'afterRender'
		});
	};

	/**
	 * Stop animation frame and render loop
	 *
	 * @method stopAnimation
	 */
	this.stopAnimation = function() {
		cancelAnimationFrame(animationFrameId);
	};

	this.setCenter_old = function(vector, positionFromCenter) {
		var translation = vector.clone().sub(this.center);
		//
		// //keep light direction but translate light.target
		// var lightWorld 		 = this.directionalLight.parent.localToWorld(this.directionalLight.position.clone());
		// var lightTargetWorld = this.directionalLight.target.parent.localToWorld(this.directionalLight.target.position.clone());
		// var lightWorldNew 	 = lightWorld.add(translation);
		// this.directionalLight.position = this.directionalLight.parent.worldToLocal(lightWorldNew);
		//
		// this.directionalLight.target.position = vector.clone();

		//scene center
		this.center = vector.clone();
		//focus camera on center
		if (positionFromCenter) {
			//translate and focus camera on center
			// console.log(positionFromCenter.length());
			// this.camera.position = vector.clone().add(positionFromCenter); //-r76
			this.camera.position.copy( vector.clone().add(positionFromCenter) ); //+r76
			this.camera.lookAt(this.center);
			this.camera.target.position.setZ(-positionFromCenter.length());
			
		} else {
			//just translate
			this.camera.position.add(translation);
		}

		// var positionFromCenter = positionFromCenter || this.camera.position.clone().sub(this.camera.target.parent.localToWorld(this.camera.target.position.clone())); //new THREE.Vector3(0,0,0);
		// this.camera.position = vector.clone().add(positionFromCenter);
		// this.camera.target.position = positionFromCenter.clone().multiplyScalar(-1);
		//this.camera.lookAt(this.center);
		// //this.camera.target.position = this.camera.target.parent.worldToLocal(vector.clone());
		this.dispatchEvent({
			type : 'center',
			content : {
				center : vector.clone(),
				translation : translation,
				positionFromCenter : positionFromCenter
			}
		});
	};
	
	
	/**
	 * Jump to another place in the scene.
	 * 
	 * @method setCenter
	 * @param {THREE.Vector3} vector vector in scene coordinates
	 * @param {THREE.Vector3} positionFromCenter vector to place the camera at some distance from the point of interest (vector)
	 * @param {Number} duration duration in milliseconds. if undefined or > 0 an animation is perforemed from the current to the specified new center. Set this to 0 to jump immediately to the new location.
	 */
	var _setCenterActive=false;
	var _setCenterTween = null;
	this.setCenter = function(vector, positionFromCenter, duration) {
		// stop exisitng tween when a new one comes during animation time
		if(_setCenterActive && _setCenterTween){_setCenterTween.stop();_setCenterActive=false;}
		
		if(!_setCenterActive){
				_setCenterActive = true;
		//var active = "false"; // avoid multiple calls at a time
		var duration = (duration == null)?1000:duration;
		var oldCamTargetPos	= this.center;//this.camera.localToWorld(this.camera.target.position.clone());
		var newCamTargetPos	= vector.clone();
		var positionFromCenter = positionFromCenter || this.camera.position.clone().sub( oldCamTargetPos );
		var oldCamPos		= this.camera.position.clone();
		var newCamPos 		= vector.clone().add(positionFromCenter);
		var lookAtVector	= new THREE.Vector3();
		var numDecimals = 3;
		
		var tweenValues = {
			tx: oldCamTargetPos.x,
			ty: oldCamTargetPos.y,
			tz: oldCamTargetPos.z,
			cx: oldCamPos.x,
			cy: oldCamPos.y,
			cz: oldCamPos.z
		};
		var targetValues = {
			tx: newCamTargetPos.x,
			ty: newCamTargetPos.y,
			tz: newCamTargetPos.z,
			cx: newCamPos.x,
			cy: newCamPos.y,
			cz: newCamPos.z
		};
		//scene center
		this.center = vector.clone();
		// console.log("Scene.setCenter():duration: "+duration);
		if(duration == 0){
			this.camera.position.set(parseFloat(targetValues.cx.toFixed(numDecimals)), parseFloat(targetValues.cy.toFixed(numDecimals)), parseFloat(targetValues.cz.toFixed(numDecimals)));
			this.camera.lookAt(lookAtVector.set(parseFloat(targetValues.tx.toFixed(numDecimals)),parseFloat(targetValues.ty.toFixed(numDecimals)),parseFloat(targetValues.tz.toFixed(numDecimals))));
			this.camera.target.position.setZ(-positionFromCenter.length());
			/**
			 * Fires after setCenter() completed
			 * @event center
			 */
			this.dispatchEvent({
				type : 'center',
				content : {
					center : vector.clone(),
					translation : oldCamTargetPos.clone().sub(newCamTargetPos),
					positionFromCenter : positionFromCenter
				}
			});
			_setCenterActive = false;
		}
		else {
			
				//tween camera target position and camera position
				_setCenterTween = new TWEEN.Tween(tweenValues)
											.to(targetValues,duration)
											.easing( TWEEN.Easing.Quartic.Out )
											.onUpdate(function(){
												this.camera.position.set(parseFloat(tweenValues.cx.toFixed(numDecimals)), parseFloat(tweenValues.cy.toFixed(numDecimals)), parseFloat(tweenValues.cz.toFixed(numDecimals)));
												this.camera.lookAt(lookAtVector.set(parseFloat(tweenValues.tx.toFixed(numDecimals)),parseFloat(tweenValues.ty.toFixed(numDecimals)),parseFloat(tweenValues.tz.toFixed(numDecimals))));
											}.bind(this))
											.onComplete(function(){
												this.camera.target.position.setZ(-positionFromCenter.length());
												/**
												 * Fires after setCenter() completed
												 * @event center
												 */
												this.dispatchEvent({
													type : 'center',
													content : {
														center : vector.clone(),
														translation : oldCamTargetPos.clone().sub(newCamTargetPos),
														positionFromCenter : positionFromCenter
													}
												});
												
												_setCenterActive = false;
												
												}.bind(this))
											.start();		
				
			}
		

		//this is done every frame update by OrbitZoomPan-Control
		// if (this.camera.inOrthographicMode) {
			// this.camera.toOrthographic();
		// }
		
		}	
	};
	
	/**
	 * Function to move camera to predefined relative positions from Scene.center
	 * 
	 * @method viewFrom
	 * @param {String} relativePosition allowed values are 'left','right','front','back','top','bottom'
	 */
	this.viewFrom = function(relativePosition) {
		var distanceToCenter = this.camera.position.clone().sub( this.center ).length();
		var direction = new THREE.Vector3(0,0,1); //default 'front'
		switch (relativePosition) {
			case 'left': 
				direction = new THREE.Vector3(-1,0,0);
				break;
			case 'right':
				direction = new THREE.Vector3(1,0,0);
				break;
			case 'front':
				direction = new THREE.Vector3(0,0,1);
				break;
			case 'back':
				direction = new THREE.Vector3(0,0,-1);
				break;
			case 'top':
				direction = new THREE.Vector3(0,1,0.01);
				break;	
			case 'bottom':
				direction = new THREE.Vector3(0,-1,0.01);
				break;	
			default:
				console.error('Value "' + relativePosition + '" not supported!');	
		}
		
		this.setCenter(this.center, direction.clone().multiplyScalar(distanceToCenter));
	};

	/**
	 * Adds a control to the scene
	 *
	 * @method addControl
	 */
	this.addControl = function(control) {
		// add Control to controls array
		this.controls.push(control);
		control.setScene(this);

	};

	/**
	 * Removes a control from the scene
	 *
	 * @method removeControl
	 */
	this.removeControl = function(control) {
		control.deactivate();
		var x = 0;
		while (x < this.controls.length) {
			if (control === this.controls[x]) {
				this.controls.splice(x, 1);
			}
			x++;
		}
		control.setScene(null);
	};

	/**
	 * Adds a layer to the scene
	 *
	 * @method addLayer
	 */
	this.addLayer = function(layer) {
		this.layers.push(layer);
		layer.setScene(this);
		this.root.add(layer.root);
		/**
		 * @event addlayer 
		 */
		this.dispatchEvent({ type: 'addlayer', content: layer });
	};

	/**
	 * Removes a layer from the scene
	 *
	 * @method removeLayer
	 */
	this.removeLayer = function(layer) {
		/**
		 * @event removelayer 
		 */
		this.dispatchEvent({ type: 'beforeremovelayer', content: layer });
		this.root.remove(layer.root);
		var x = 0;
		while (x < this.layers.length) {
			if (layer === this.layers[x]) {
				this.layers.splice(x, 1);
			}
			x++;
		}
		layer.setScene(null);
		/**
		 * @event removelayer 
		 */
		this.dispatchEvent({ type: 'removelayer', content: layer });
	};
	
	/**
	 * Deletes all layer objects and the layer from memory
	 * 
	 * @method disposeLayer
	 * @param {GIScene.Layer} layer
	 * 
	 *  @TODO remove all working materials first
	 *  @TODO removeEventListeners
	 */
	this.disposeLayer = function(layer) {
		this.removeLayer(layer);
		
		var objects = GIScene.Utils.getDescendants(layer.root); //r76 
		objects.push(layer.root);
		//get all geoms, materials, textures
		var materials = [], textures = [];
		
		objects.forEach(function(object){
			//@TODO Docs fire event to clear references in other objects, eg. selectables in Control.Select
			this.dispatchEvent( { type: 'beforeDisposeObject', content: object } );
			
			if(object.geometry){
				object.geometry.dispose();
				delete object.geometry;
			}
			
			//get materials
			if (object.material) {
				if (object.material instanceof THREE.MeshFaceMaterial) {
					object.material.materials.forEach(function(material) {
						if (! GIScene.Utils.arrayContains(materials, material)) {
							materials.push(material);
						};
					});
				} else {

					if (! GIScene.Utils.arrayContains(materials, object.material)) {
						materials.push(object.material);
					};
				}
			}
			delete object.material;
			
			
			// // get textures
			// materials.forEach(function(material) {
				// var maps = ["map", "lightMap", "bumpMap", "normalMap", "specularMap", "envMap"];
				// for (var i = 0, j = maps.length; i < j; i++) {
					// if (material[maps[i]] && material[maps[i]] != null && ! GIScene.Utils.arrayContains(textures, material[maps[i]])) {
						// textures.push(material[maps[i]]);
					// };
				// };
			// }); 
			
			//dispose objects
			if(object.dispose)object.dispose();
			object = null;
		}.bind(this)
		);
		
		//get further materials from styles
		layer.styles.forEach(function(style){
			if (style.material) {
				if (style.material instanceof THREE.MeshFaceMaterial) {
					style.material.materials.forEach(function(material) {
						if (! GIScene.Utils.arrayContains(materials, material)) {
							materials.push(material);
						};
					});
				} else {

					if (! GIScene.Utils.arrayContains(materials, style.material)) {
						materials.push(style.material);
					};
				}
			}
			
		});
		
		// get textures
			materials.forEach(function(material) {
				var maps = ["map", "lightMap", "bumpMap", "normalMap", "specularMap", "envMap", "texture"]; //texture exists in RasterOverlayMaterial
				for (var i = 0, j = maps.length; i < j; i++) {
					if (material[maps[i]] && material[maps[i]] != null && ! GIScene.Utils.arrayContains(textures, material[maps[i]])) {
						textures.push(material[maps[i]]);
					};
				};
			}); 
		
		//dispose textures, materials
		textures.forEach(function (texture) {
		  texture.dispose();
		});
		textures = null;
		
		materials.forEach(function (material) {
		  material.dispose();
		});
		materials = null;
		
		objects = null;
		
		//remove THREE.EventDispatcher listeners
		for (type in layer._listeners){
			delete layer._listeners[type];
		}
		for (type in layer.loader._listeners){
			delete layer.loader._listeners[type];
		}
		
		layer = null;
	};
	
	/**
	 * Set the wireframe property for the whole scene
	 * @method setWireframe
	 * @param {Mixed} wireframeMode can be {String} 'default' | {boolean} true | {boolean} false
	 */
	
	this.setWireframe = function(wireframeMode) {
		this.root.traverse(function(object) {
			
			GIScene.Utils.WorkingMaterial.setWireframe(object,wireframeMode);
			
			// if (object.material) {
				// if(!object.userData.originalMaterial){
					// // if no working material exists create one 
					// object.userData.originalMaterial = object.material;
					// object.material = object.userData.originalMaterial.clone();
				// }
				// if(object.userData.workingMaterialFlags && (object.userData.workingMaterialFlags & GIScene.WORKINGMATERIALFLAGS.WIRE) != 0){
					// //if wire flag exist remove and check if workingmaterial is still in use, and change state or material
					// object.userData.workingMaterialFlags ^= GIScene.WORKINGMATERIALFLAGS.WIRE;
					// if(object.userData.workingMaterialFlags == 0){
						// //change back to original material
						// object.material = object.userData.originalMaterial;
						// object.userData.originalMaterial = null;
						// delete object.userData.originalMaterial;
					// }
					// else{
						// // set original state
// 						
						// //for multimaterial objects
						// if("materials" in object.material){
							// object.material.materials.forEach(
								// function (e,i,a){
									// a[i].wireframe = isTrue;
								// }
							// );
						// }
// 						
						// // for single material objects
						// else {
							// object.material.wireframe = isTrue;
						// }
					// }
				// }
				// else{
					// //set wireflag and change wireframe state
					// //set wire flag
					// object.userData.workingMaterialFlags = ("workingMaterialFlags" in object.userData)? object.userData.workingMaterialFlags ^ GIScene.WORKINGMATERIALFLAGS.WIRE : GIScene.WORKINGMATERIALFLAGS.WIRE ;
					// //change wireframe state
// 					
					// //for multimaterial objects
						// if("materials" in object.material){
							// object.material.materials.forEach(
								// function (e,i,a){
									// a[i].wireframe = isTrue;
								// }
							// );
						// }
// 						
						// // for single material objects
						// else {
							// object.material.wireframe = isTrue;
						// }
				// }
// 				
			// }
		});
	}; 

	/**
	 * Sets texturing of on or off for the whole scene
	 * @method setTexturing
	 * @param {Mixed} texturingMode can be: {String} 'default' | {boolean} true | {boolean} false
	 */
	this.setTexturing = function(texturingMode) {
		this.root.traverse(function(object) {
			
			GIScene.Utils.WorkingMaterial.setTexturing(object, texturingMode);
			
		});
	};
	
	/**
	 * Sets the face culling mode for the whole scene
	 * 
	 * @method setFaceCulling
	 * @param {THREE.FrontSide || THREE.BackSide || THREE.DoubleSide || 'default'} faceCullingMode
	 */
	
	this.setFaceCulling = function(faceCullingMode) { //use THREE.FrontSide || THREE.BackSide || THREE.DoubleSide || 'default'
		this.root.traverse(function(object) {
			
			GIScene.Utils.WorkingMaterial.setFaceCulling(object,faceCullingMode);
			
		}
		);
	};
	
	/**
	 * Sets the vertex color mode for the whole scene
	 * 
	 * @method setVertexColors
	 * @param {THREE.NoColors || THREE.FaceColors || THREE.VertexColors || 'default'} vertexColorMode
	 */
	
	this.setVertexColors = function(vertexColorMode) { 
		this.root.traverse(function(object) {
			
			GIScene.Utils.WorkingMaterial.setVertexColors(object,vertexColorMode);
			
		}
		);
	};
	
	/**
	 * Sets the shading mode for the whole scene
	 * 
	 * @method setShading
	 * @param { THREE.FlatShading || THREE.SmoothShading || 'default' } shadingMode
	 */
	this.setShading = function(shadingMode) { //use THREE.FlatShading || THREE.SmoothShading || 'default'
		this.root.traverse(function(object) {
			
			GIScene.Utils.WorkingMaterial.setShading(object,shadingMode);
			
		}
		);
	};
	
	/**
	 * get all descendants of the layers. Optionally the layers can be filtered by an array filter function.
	 * 
	 * @method getLayerDescendants
	 * @param {Function} filter An array filter function that is applied to each layer object of the scene. Should return true or false. 
	 * @example
	 * 	//get only descendants of layers that are not Helper Layers
	 * 	scene.getLayerDescendants(function(e,i,a){
	 * 		return !(e instanceof GIScene.Layer.Helper);
	 * 		}
	 *	);
	 *  
	 */
	this.getLayerDescendants = function(filter){
		var layerDescendants = [];
		var layers = this.layers;
		
		if(typeof filter == 'function'){
			layers = layers.filter(filter);
		}
		
		for(var i=0,j=layers.length; i<j; i++){
		  GIScene.Utils.getDescendants( layers[i].root , layerDescendants ); //r76
		};
		
		return layerDescendants;
	};
	
	/**
	 * @method getLayerById
	 * @param {String} id
	 * @return {GIScene.Layer} result returns the layer found by id or null
	 */
	this.getLayerById = function(id) {
		var result = null;
		for (var i=0,j=this.layers.length;i<j;i++){
			if(this.layers[i].id.toString() === id.toString()) return this.layers[i];
		}
		return result;
	};

	var debugView = false;
	this.toggleDebugView = function() {
		if(debugView){
			debugView = false;
			this.camera.target.remove(this.camera.target.children[1]);
		}
		else{
			debugView = true;
			var sphereGeom1 = new THREE.SphereGeometry(0.1,8,8);
			var camTargetDummy = new THREE.Mesh(sphereGeom1);
			this.camera.target.add(camTargetDummy);
			
			var sphereGeom2 = new THREE.SphereGeometry(0.2,10,10);
			var pivotLightDummy = new THREE.Mesh(sphereGeom2);
			cameraLightControl.pivotLight.add(pivotLightDummy);
		}
	};
	
	//start auto initialization
	this.init();
	
	//set viewport on resize
	this.onResize = function(event) {
		var w = this.containerDiv.clientWidth;
		var h = this.containerDiv.clientHeight;
		this.renderer.setSize( w, h );
		this.effectComposer.setSize( w, h );
		this.camera.setSize( w, h );
		this.camera.updateProjectionMatrix();
		
		this.spriteCamera.left = -w/2;
		this.spriteCamera.right = w/2;
		this.spriteCamera.top = h/2;
		this.spriteCamera.bottom = -h/2;
		this.spriteCamera.updateProjectionMatrix();
		
		//update logo position
		this.logoOnResize();
	}.bind(this);
	window.addEventListener('resize', this.onResize, false);
	
	this.onUnload = function(event) {
		//@TODO free memory before reload
		
		this.stopAnimation();
		
		//deactivate all controls to removeEventListeners on canvas etc
		for(var i=0,j=this.controls.length; i<j; i++){
		  if(this.controls[i].isActive)this.controls[i].deactivate();
		};
		
		//dispose all layers
		for(var i=0,j=this.layers.length; i<j; i++){
		  this.disposeLayer(this.layers[i]); 
		};
		
		this.containerDiv.innerHTML = "";
		
		for (props in this){
			delete this[props];
		}
		
		
		
	}.bind(this);
	window.addEventListener('unload', this.onUnload, false);
};

//Provide EventDispatcher Functions
GIScene.Scene.prototype = {

	constructor : GIScene.Scene,
	
	/**
	 * get Objects by a evaluation function which recursively tries to match the objects of the scene
	 * 
	 * @method getObjectsBy
	 * @param {Function} callback
	 * @return {Array} matches
	 */
	getObjectsBy : function(callback) {
		return GIScene.Utils.getObjectsBy(this.root,callback);
	},

	/**
	 * inherited from THREE.EventDispatcher
	 *
	 * @method addEventListener
	 * @param {String} eventType
	 * @param {Function} listener function, to be called when the event is dispatched
	 */
	addEventListener : THREE.EventDispatcher.prototype.addEventListener,
	
	/**
	 * inherited from THREE.EventDispatcher
	 *
	 * @method hasEventListener
	 * @param {String} eventType
	 * @param {Function} listener function, to be removed from the event
	 */
	hasEventListener : THREE.EventDispatcher.prototype.hasEventListener,
	
	/**
	 * inherited from THREE.EventDispatcher
	 *
	 * @method removeEventListener
	 * @param {String} eventType
	 * @param {Function} listener function, to be removed from the event
	 */
	removeEventListener : THREE.EventDispatcher.prototype.removeEventListener,
	
	/**
	 * inherited from THREE.EventDispatcher
	 *
	 * @method dispatchEvent
	 * @param {Object} event
	 * @example this.dispatchEvent( { type: 'beforeRender', content: anythingToBePassedToTheListeners } );
	 *
	 */
	dispatchEvent : THREE.EventDispatcher.prototype.dispatchEvent

};
