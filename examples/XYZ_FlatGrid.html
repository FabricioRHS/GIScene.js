<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>GIScene.js example - XYZFlatTiles Layer with XYZ Raster Map Overlay from OpenStreetMap</title>
		<script src="js/THREE/r76/three.min.js"></script>
		<!-- <script src="js/GIScene/GIScene_2.0.0.js"></script> -->
		<script src="../builds/GIScene_2.0.0.js"></script>
		<script src="../lib/GIScene/Layer/Grid/XYZFlatTiles.js"></script>
		<style>
			body {
				bottom: 0;
			    font-family: sans-serif;
			    left: 0;
			    position: absolute;
			    right: 0;
			    top: 0;
			}
			
			#container {
				position: absolute;
				top:0;
				bottom:20%;
				left:0;
				right:0;
				
			}
			
			#scene {
				bottom: 0;
			    left: 0;
			    position: absolute;
			    right: 0;
			    top: 0;
				
			}
			div#controls {
				background-color: rgba(255, 255, 255, 0.7);
				position: absolute;
				right: 50px;
				top: 50px;
				text-align: right;
				padding: 5px;
				text-align: left;
			}
			div#attribution {
				position: absolute;
				top:80%;
			}
		</style>
		<script>
		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		  (i[r].q=i[r].q||[]).push(arguments);},i[r].l=1*new Date();a=s.createElement(o),
		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m);
		  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		
		  ga('create', 'UA-70640742-1', 'auto');
		  ga('send', 'pageview');
		</script>
	</head>
	<body>
		
		<div id="container">
			<div id="scene"></div>
		</div>
		<div id="attribution">
		  <h1>GIScene.js example - XYZFlatTiles Layer with XYZ Raster Map Overlay from OpenStreetMap</h1>
		  <h2>Data Sources:</h2>
		  <ul>
		  	<li>Map overlays: 
		  		<ul>
		  		<li>OpenStreetMap Mapnik &copy; by OSM conttibutors. Available at <a href="http://www.openstreetmap.org/">http://www.openstreetmap.org/</a></li>
		  		</ul>
		  	</li>
		  </ul>
		</div>
		<script>
			var onLoad2 = function(event) {
				
				var layer = event.content;
				
				//set camera to focus object
				scene.setCenter(layer.boundingBox.center(), new THREE.Vector3(-5000, 3000, 5000));
				
				
			};
		
		


			//create a new scene
			var scene_options =  {
			    projection: "EPSG:3857",
			    positionFromCenter : new THREE.Vector3(0, 20000000, 10000000),
				near : 100,
				far  : 100000000,
				skyColor : new THREE.Color().setStyle('black')
			};
			
			var scene = new GIScene.Scene('scene', scene_options);
			
			//create, add and activate a loading indicator
			var load_ctrl = new GIScene.Control.LoadIndicator();
			scene.addControl(load_ctrl);
			load_ctrl.activate();
			
			//light adjustment
			scene.directionalLight.position.set(-1,1,-1); //light from northwest
			//scene.ambientLight.color.setRGB(0.2,0.2,0.2);
			
			//add a layer
			//3857:  -20037508.34,-20037508.34,20037508.34,20037508.34 //20037508.3427892 
			var z0Res = 20037508.3427892 * 2;
			
			// var texloader = new THREE.TextureLoader();
			// texloader.setCrossOrigin("anonymous");
			
			var layer_options = {
				url : "http://a.tile.openstreetmap.org/{z}/{x}/{y}.png",
				format : GIScene.Format.JSON,
				verticalAxis : "Z",
				terrainHeight: 0,
				maxDistance: 100000000,
				
				//listeners: [ { 'load' : onLoad2 } ]
			};
			
			var layer = new GIScene.Layer.XYZFlatTiles("Layername", layer_options);
			scene.addLayer(layer);
			
			//create, add and activate a navigation control
			var nav_ctrl = new GIScene.Control.PanOrbitZoomCenter(scene.camera, scene.containerDiv);
			
			scene.addControl(nav_ctrl);
			
			nav_ctrl.activate();
			
			//camera position control
			var pos_ctrl = new GIScene.Control.ObjectPosition(scene.camera, scene.containerDiv);
			
			scene.addControl(pos_ctrl);
			
			pos_ctrl.activate();
			
			//compass
			var compass_ctrl = new GIScene.Control.Compass(scene.camera, scene.containerDiv);
			
			scene.addControl(compass_ctrl);
			
			compass_ctrl.activate();
			
			//prevent scrolling when mouse over scene
			function preventDefault(e) {
				console.log('preventDefault');
			  	e = e || window.event;
			  	if (e.preventDefault)
			    	e.preventDefault();
			  	e.returnValue = false;  
			}
			
			var parentNoScroll = function () {
				
				window.addEventListener("DOMMouseScroll", preventDefault, false);
	   			window.addEventListener("mousewheel", preventDefault, false);
	   			window.addEventListener("MozMousePixelScroll", preventDefault, false);
	   			
			};
			
			var parentScroll = function () {
				
				window.removeEventListener("DOMMouseScroll", preventDefault, false);
	   			window.removeEventListener("mousewheel", preventDefault, false);
	   			window.removeEventListener("MozMousePixelScroll", preventDefault, false);
	   			
			};
			
			scene.containerDiv.addEventListener("mouseenter", parentNoScroll, false);	
	   		scene.containerDiv.addEventListener("mouseleave", parentScroll, false);
		</script>
				
	</body>
</html>